<!DOCTYPE HTML>
<html>
<head>
    <title>FISALAND</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main2.css" />
    <style>
        /* 마켓 정보 스타일 */
        #market-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px auto;
            max-width: 800px;
        }

        #market-info .highlight {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            width: 100%;
            margin-bottom: 20px;
        }

        #market-info img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
        }

        #market-info h2 {
            margin: 0 0 10px;
            font-size: 2em;
        }

        #market-info p {
            margin: 0 0 10px;
            font-size: 1.2em;
        }

        #market-info .rating {
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
        }
    </style>
</head>
<body class="homepage is-preload">
    <div id="page-wrapper">
        <!-- Header -->
        <section id="header" class="wrapper">
            <!-- Logo -->
            <div id="logo">
                <h1><a href="index">FISALAND</a></h1>
                <p>FISA 인들의 솔직한 리뷰 확인하기</p>
            </div>

            <!-- Nav -->
            <nav id="nav">
                <ul>
                    <li class="current"><a href="main">Home</a></li>
                    <li><a href="myGathering">Gathering</a>
                        <ul>
                            <li><a href="#">Lorem ipsum</a></li>
                            <li><a href="#">Magna veroeros</a></li>
                            <li><a href="#">Etiam nisl</a></li>
                            <li><a href="#">Sed consequat</a>
                                <ul>
                                    <li><a href="#">Lorem dolor</a></li>
                                    <li><a href="#">Amet consequat</a></li>
                                    <li><a href="#">Magna phasellus</a></li>
                                    <li><a href="#">Etiam nisl</a></li>
                                    <li><a href="#">Sed feugiat</a></li>
                                </ul>
                            </li>
                            <li><a href="#">Nisl tempus</a></li>
                        </ul>
                    </li>
                    <li><a href="market">Market</a></li>
                    <li><a href="village">Village</a></li>
                    <li><a href="marketReview">My Review</a></li>
                </ul>
            </nav>
        </section>

        <!-- 마켓 정보 표시 -->
        <div id="market-info">
            <!-- 마켓 정보가 여기에 동적으로 추가됩니다 -->
        </div>

        <!-- Highlights -->
        <section id="highlights" class="wrapper style3">
            <div class="title">Reviews</div>
            <div class="container">
                <div class="row aln-center" id="highlights-container">
                    <!-- Reviews will be dynamically inserted here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Custom Scripts -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const marketId = 1; // 예시로 고정된 marketId
            const reviewsUrl = `http://localhost:8080/market/${marketId}/review`;
            const marketInfoUrl = `http://localhost:8080/market/${marketId}`;

            // 마켓 정보와 리뷰를 가져옵니다
            Promise.all([
                fetch(reviewsUrl).then(response => response.json()),
                fetch(marketInfoUrl).then(response => response.json())
            ])
            .then(([reviewsData, marketData]) => {
                const reviewsContainer = document.getElementById("highlights-container");
                reviewsContainer.innerHTML = ''; // 기존 내용 지우기

                const reviewsToShow = reviewsData.slice(0, 3);

                // 평균 평점 계산
                const averageRating = reviewsToShow.reduce((sum, review) => sum + review.rate, 0) / reviewsToShow.length;

                // 마켓 정보 표시
                const marketInfoContainer = document.getElementById("market-info");
                marketInfoContainer.innerHTML = `
                    <section class="highlight">
                        <h2 id="market-name">${marketData.name}</h2>
                        <p id="market-location">Location: ${marketData.location}</p>
                        <p class="rating">평점 평균: ${averageRating.toFixed(1)}</p>
                        <img id="market-image" src="images/market-sample.jpg" alt="Market Image" />
                    </section>
                `;

                reviewsToShow.forEach(review => {
                    // 각 리뷰를 화면에 표시
                    const colDiv = document.createElement("div");
                    colDiv.className = "col-4 col-12-medium";

                    const section = document.createElement("section");
                    section.className = "highlight";

                    const img = document.createElement("img");
                    img.src = "images/pic0" + ((Math.floor(Math.random() * 4)) + 2) + ".jpg";
                    img.alt = review.content;
                    img.className = "image featured";
                    const imgLink = document.createElement("a");
                    imgLink.href = "#";
                    imgLink.appendChild(img);

                    const h3 = document.createElement("h3");
                    const titleLink = document.createElement("a");
                    titleLink.href = "#";
                    titleLink.textContent = `Rating: ${review.rate}`;
                    h3.appendChild(titleLink);

                    const p = document.createElement("p");
                    p.textContent = review.content;

                    const ul = document.createElement("ul");
                    ul.className = "actions";
                    const li = document.createElement("li");

                    section.appendChild(imgLink);
                    section.appendChild(h3);
                    section.appendChild(p);
                    ul.appendChild(li);
                    section.appendChild(ul);
                    colDiv.appendChild(section);
                    reviewsContainer.appendChild(colDiv);
                });
            })
            .catch(error => console.error('Error fetching data:', error));
        });
    </script>
</body>
</html>
